//! Xyllidium Hybrid Signature Suite (XHSS-MAX)

use super::xmss::*;
use super::sphincs::*;

#[derive(Debug, Clone)]
pub struct XhssPublicKey {
    pub xmss: XmssPublicKey,
    pub sphincs: SphincsPublicKey,
}

#[derive(Debug, Clone)]
pub struct XhssSecretKey {
    pub xmss: XmssSecretKey,
    pub sphincs: SphincsSecretKey,
}

#[derive(Debug, Clone)]
pub struct XhssSignature {
    pub xmss_sig: XmssSignature,
    pub sphincs_sig: SphincsSignature,
}

pub fn xhss_generate_keypair() -> (XhssSecretKey, XhssPublicKey) {
    let (xmss_sk, xmss_pk) = xmss_generate_keypair();
    let (spx_sk, spx_pk) = sphincs_generate_keypair();

    (
        XhssSecretKey {
            xmss: xmss_sk,
            sphincs: spx_sk,
        },
        XhssPublicKey {
            xmss: xmss_pk,
            sphincs: spx_pk,
        },
    )
}

pub fn xhss_sign(sk: &XhssSecretKey, msg: &[u8]) -> XhssSignature {
    let xmss_sig = xmss_sign(&sk.xmss, msg);
    let spx_sig = sphincs_sign(&sk.sphincs, msg);

    XhssSignature {
        xmss_sig,
        sphincs_sig: spx_sig,
    }
}

pub fn xhss_verify(pk: &XhssPublicKey, msg: &[u8], sig: &XhssSignature) -> bool {
    xmss_verify(&pk.xmss, msg, &sig.xmss_sig)
        && sphincs_verify(&pk.sphincs, msg, &sig.sphincs_sig)
}
